<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
</head>

<body>
    <h1 align=center>Settings</h1>
    <form action='/config' method='POST' width=100% >
        <div >WLAN</div>
        <div>
            <span align=left>ssid</span>
            <input type="text" name="ssid" align=right id="ap_ssid">
        </div>
        <div>
            <span>password</span>
            <input type="text" name="password" id="ap_password">
        </div>

        <div>OpenWeather</div>
        <div>
            <span>apikey</span>
            <input type="text" name="apikey" id="ow_apikey">
        </div>
        <div>
            <span>server</span>
            <input type="text" name="server" id="ow_server">
        </div>
        <div>
            <span>Country</span>
            <input type="text" name="country" id="ow_country">
        </div>
        <div>
            <span>City</span>
            <input type="text" name="city" id="ow_city">
        </div>
        <div>
            <span>Hemisphere</span>
            <select name='hemisphere' id="ow_hemisphere">
                <option value='north'>north</option>
                <option value='south'>south</option>
            </select>
        </div>
        <div>
            <span>Units</span>
            <select name='units' id="ow_units">
                <option value='M'>Metric</option>
                <option value='I'>Imperial</option>\
            </select>
        </div>

        <span>NTP</span>
        <div>
            <span>server</span>
            <input type="text" name="ntp_server" id="ntp_server">
        </div>
        <div>
            <span>Timezone</span>
            <input type="text" name="ntp_timezone" id="ntp_timezone">
        </div>

        <span>Schedule power on/off</span>
        <div >
            <span align=left>Power on time</span>
            <input type="time" name="on_time" align=right id="on_time"></div>
        <div>
            <span>Power off time</span>
            <input type="time" name="off_time" id="off_time">
        </div>
        <p align=center><INPUT type='submit' value='Save and restart'></p>
    </form>

    <script>
        var xmlhttp;
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.open("get", "/config", false);
        xmlhttp.send();
        console.log(xmlhttp.responseText)
        var obj = JSON.parse(xmlhttp.responseText)
        if (obj) {
            document.getElementById("ap_ssid").value = obj.WLAN.ssid;
            document.getElementById("ap_password").value = obj.WLAN.password;
            document.getElementById("ow_apikey").value = obj.OpenWeather.apikey;
            document.getElementById("ow_server").value = obj.OpenWeather.server;
            document.getElementById("ow_country").value = obj.OpenWeather.country;
            document.getElementById("ow_city").value = obj.OpenWeather.city;
            var select1 = document.getElementById("ow_hemisphere");
            for (var i = 0; i< select1.children.length; i++) {
                if(select1.children.item(i).getAttribute('value') === obj.OpenWeather.hemisphere) {
                    select1.children.item(i).setAttribute('selected','selected');
                }
            }
            var select1 = document.getElementById("ow_units");
            for (var i = 0; i< select1.children.length; i++) {
                if(select1.children.item(i).getAttribute('value') === obj.OpenWeather.units) {
                    select1.children.item(i).setAttribute('selected','selected');
                }
            }
            document.getElementById("ntp_server").value = obj.ntp.server;
            document.getElementById("ntp_timezone").value = obj.ntp.timezone;
            // document.getElementById("on_time").setAttribute('value', obj.schedule_power.on_time);
            // document.getElementById("off_time").setAttribute('value', obj.schedule_power.off_time);
            document.getElementById("on_time").value = obj.schedule_power.on_time;
            document.getElementById("off_time").value = obj.schedule_power.off_time;
        }
    </script>
</body>

</html>